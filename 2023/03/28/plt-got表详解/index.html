
<!DOCTYPE html>
<html lang="zn-CN">
    <head>
        
        <meta charset="UTF-8" />
        <title>plt&amp;got表详解 | xi &amp; Blog</title>
        <meta name="author" content="enicky" />
        <meta name="description" content="一个萌新pwn手的小房间" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/images/avatar.jpg" />
        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>XI &amp; BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;归雁</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;相系</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;归档</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;析构</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;一点惊鸿</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;XI &amp; BLOG</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">归雁</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">相系</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">归档</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">析构</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">一点惊鸿</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>plt&amp;got表详解</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/28
        </span>
        
        
    </div>
    
    <div class="content" v-pre>
        <h3 id="一-简介plt和got表"><a href="#一-简介plt和got表" class="headerlink" title="一.简介plt和got表"></a>一.简介plt和got表</h3><h4 id="1-plt"><a href="#1-plt" class="headerlink" title="1.plt"></a>1.plt</h4><p>PLT : 程序链接表（PLT，Procedure Link Table）</p>
<h4 id="2-got"><a href="#2-got" class="headerlink" title="2.got"></a>2.got</h4><p>GOT : 全局偏移表（GOT, Global Offset Table）</p>
<p>plt以及got的缘由都来自于文件的动态链接，简言之：</p>
<ul>
<li>需要存放外部函数的数据段 —— PLT</li>
<li>获取数据段存放函数地址的一小段额外代码 —— GOT</li>
</ul>
<blockquote>
<p>如果可执行文件中调用多个动态库函数，那每个函数都需要这两样东西，这样每样东西就形成一个表，每个函数使用中的一项。</p>
<p>　　存放函数地址的数据表，称为全局偏移表（GOT, Global Offset Table），而那个额外代码段表，称为程序链接表（PLT，Procedure Link Table）。</p>
</blockquote>
<hr>
<p>注：更详细的解释可以查看大佬博客，这里就不做深入解释。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/farmwang/article/details/73556017">https://blog.csdn.net/farmwang/article/details/73556017</a></p>
<h3 id="二-保护机制"><a href="#二-保护机制" class="headerlink" title="二.保护机制"></a>二.保护机制</h3><p><strong>RELRO（RELocation Read Only）</strong></p>
<p>在Linux中有两种RELRO模式：”Partial RELRO” 和 “Full RELRO”。Linux中Partical RELRO默认开启</p>
<p><strong>Partial RELRO：</strong></p>
<p>特点：</p>
<ul>
<li>该ELF文件的各个部分被重新排序。内数据段（internal data sections）（如.got，.dtors等）置于程序数据段（program’s data sections）（如.data和.bss）之前；</li>
<li>无 plt 指向的GOT是只读的；</li>
<li>GOT表可写（应该是与上面有所区别的）。</li>
</ul>
<p><strong>Full RELRO：</strong>简言之,会导致GOT表完全不可写。</p>
<ul>
<li>支持Partial模式的所有功能；</li>
<li>整个GOT表映射为只读的。</li>
</ul>
<h3 id="三-调用过程"><a href="#三-调用过程" class="headerlink" title="三.调用过程"></a>三.调用过程</h3><p>分为第一次和第二次调用：</p>
<p>第一次调用：</p>
<p>在函数调用时，程序会call plt表中的地址，而plt表会跳转got表中的地址同时给plt表项的后六个字节，这个时候plt表得知got表没有自己想要jmp的地址，转身亲自去找需要跳转的地址，在这个过程还会将某个数压入栈中，这个数可以看出需要调用函数的ID，之后跳转回plt执行_dl_runtime_resolve函数（会根据函数的ID寻找对应函数），找到以后，plt表会将找到的函数地址给got表，然后plt跳转到相应的函数地址，成功执行call命令。</p>
<p>第二次调用(同一个函数)：</p>
<p>plt会跳转到got表寻找函数地址，got中因为第一次调用时与函数绑定，可以直接跳转到相应的函数地址。</p>
<h5 id="延迟绑定"><a href="#延迟绑定" class="headerlink" title="延迟绑定"></a>延迟绑定</h5><blockquote>
<p>这就是为什么在第一次调用时got表中没有函数地址。</p>
</blockquote>
<p>当函数第一次被用到时才进行绑定(符号査找、重定位等),如果没有用到则不进行绑定。</p>
<p>为了提到cpude效率，在程序加载时并不会解析所有函数，而是在某个函数被调用时通过plt和got来对函数解析，然后将获得的函数地址放在got中，下一次调用就会直接使用got中的函数地址来对函数进行调用。</p>
<p>四.调试过程</p>
<p>以下列代码为例进行调试</p>
<pre><code class="c">#include &lt;stdio.h&gt;
void print_banner()
&#123;
    printf(&quot;Welcome to World of PLT and GOT\n&quot;);
&#125;
int main(void)
&#123;
    print_banner();
    return 0;
&#125;
</code></pre>
<p>使用命令编译查看;</p>
<pre><code>gcc -Wall -g -o test.o -c test.c -m32
gcc -o test test.o -m32
objdump -d test.o
</code></pre>
<p><img src="C:\Users\呢实\Desktop\47ol4n8cq7(1).png" alt="47ol4n8cq7(1)"></p>
<p>printf () 和函数是在 glibc 动态库里面的，只有当程序运行起来的时候才能确定地址，所以此时的 printf () 函数先用 fc ff ff ff 也就是有符号数的 -4 代替</p>
<p>程序运行时，printf的地址就会被存储到data段（data段中存储printf地址相当于printf的got表），（相当于printf的plt表）printf_sub就会跳转到data段中printf地址，最后到printf函数。</p>
<p><img src="C:\Users\呢实\Desktop\内容\27f70ib020.jpeg" alt="27f70ib020"></p>
<p>执行过程如上所示。</p>
<hr>
<p>参考博客</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/MrTreebook/article/details/124391848">https://blog.csdn.net/MrTreebook/article/details/124391848</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/130271689">https://zhuanlan.zhihu.com/p/130271689</a></p>
<p><a target="_blank" rel="noopener" href="https://eli0t-g.github.io/post/plt%E3%80%81got%E5%92%8C%E5%BB%B6%E8%BF%9F%E7%BB%91%E5%AE%9A/">https://eli0t-g.github.io/post/plt%E3%80%81got%E5%92%8C%E5%BB%B6%E8%BF%9F%E7%BB%91%E5%AE%9A/</a></p>

    </div>
    
    
    
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2023 xi &amp; Blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;enicky
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        




        
    </body>
</html>
